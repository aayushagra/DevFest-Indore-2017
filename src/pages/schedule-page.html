<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">

<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../elements/schedule-subnav.html">
<link rel="import" href="../elements/schedule-day.html">
<link rel="import" href="../elements/my-schedule.html">

<link rel="import" href="../elements/session-details.html">
<link rel="import" href="../behaviors/utils-behavior.html">
<link rel="import" href="../behaviors/page-behavior.html">
<link rel="import" href="../behaviors/cascaded-behavior.html">


<dom-module id="schedule-page">

  <template>

    <style scope="schedule-page-0">:host > * {
  ;
}

[layout] {
  display:-ms-flexbox;display:-webkit-flex;display:flex;
}

[layout][horizontal] {
  display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;
}

[layout][vertical] {
  display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;
}

[layout][center] {
  -ms-flex-align:center;-webkit-align-items:center;align-items:center;
}

[layout][center-center] {
  -ms-flex-align:center;-webkit-align-items:center;align-items:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;
}

[flex] {
  -ms-flex:1 1 0.000000001px;-webkit-flex:1;flex:1;-webkit-flex-basis:0.000000001px;flex-basis:0.000000001px;
}

[flex-auto] {
  -ms-flex:1 1 auto;-webkit-flex:1 1 auto;flex:1 1 auto;
}

[two] {
  -ms-flex:2;-webkit-flex:2;flex:2;
}

[end-justified] {
  -ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;
}

[end] {
  -ms-flex-align:end;-webkit-align-items:flex-end;align-items:flex-end;
}

[justified] {
  -ms-flex-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;
}

[center-justified] {
  -ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;
}

[self-center] {
  -ms-align-self:center;-webkit-align-self:center;align-self:center;
}

[self-end] {
  -ms-align-self:flex-end;-webkit-align-self:flex-end;align-self:flex-end;
}

[wrap] {
  -ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;flex-wrap:wrap;
}

[inline] {
  display:-ms-inline-flexbox;display:-webkit-inline-flex;display:inline-flex;
}

[relative] {
  position:relative;
}

[fit] {
  position:absolute;top:0;right:0;bottom:0;left:0;
}

[hidden] {
  display:none !important;
}

[show] {
  display:block !important;
}

body {
  margin:0;min-height:100vh;
}

body, .markdown-html {
  font-family:'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;color:#212121;font-size:18px;font-weight:300;line-height:1.4;
}

h1, h2, h3, h4, .markdown-html h1, .markdown-html h2, .markdown-html h3, .markdown-html h4 {
  margin:0;font-weight:300;
}

a, .anchor-like, .markdown-html a {
  color:#2196F3;text-decoration:none;
}

.placeholder-color {
  background-color:#BBDEFB;
}

.container {
  padding:40px 16px;
}

.container-narrow {
  padding:20px 16px;
}

.container .heading {
  margin-bottom:20px;font-size:32px;text-transform:uppercase;letter-spacing:0.05em;
}

.page-header {
  margin:-90px auto 0;padding-bottom:20px;
}

.page-title {
  margin-left:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:20px;color:#fff;pointer-events:none;
}

.markdown-html img {
  margin-right:auto;margin-left:auto;max-width:100%;display:block;
}

@media (min-width: 769px) {
.container {
  margin:0 auto;padding:60px 16px;max-width:896px;
}

.container-narrow {
  padding:30px 16px;
}

.container .heading {
  margin-bottom:40px;
}

.page-header {
  margin:-170px auto 0;padding-bottom:0;
}

.page-title {
  font-size:42px;
}

}

@media (min-width: 1400px) {
.container {
  max-width:1280px;
}

}

.text-center {
  text-align:center;
}

.align-pb-block {
  margin-left:-9px;
}

[show] {
  transition:opacity 0.5s;opacity:1 !important;
}

[hide] {
  transition:opacity 0.5s;opacity:0 !important;
}

paper-dialog-scrollable {
  padding:0;margin:0;
}

.scrollable {
  -webkit-overflow-scrolling:touch;overflow:auto;
}

.noscroll {
  overflow:hidden;
}

paper-button.primary {
  background:#2196F3;color:#FFFFFF;
}

paper-tabs {
  ;
}

paper-tabs paper-tab {
  ;
}

paper-tab[link] {
  padding:0;
}

paper-tab[link] a {
  padding:0 12px;
}

paper-dialog {
  color:inherit;
}

:host {
  display:block;
}

.container[phone] {
  padding-right:0;padding-left:0;
}

.details {
  display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;
}

.details-item {
  display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;padding-bottom:32px;
}

.details-icon {
  ;margin-right:24px;
}

.details-info {
  -ms-flex:1 1 0.000000001px;-webkit-flex:1;flex:1;-webkit-flex-basis:0.000000001px;flex-basis:0.000000001px;
}

.details-title {
  margin-bottom:24px;font-size:24px;font-weight:400;
}

schedule-day {
  margin-bottom:64px;
}</style>

    <div class="container"><div class="details"><div class="details-item" cascaded=""><iron-icon class="details-icon" icon="info"></iron-icon><div class="details-info"><h4 class="details-title">Declare soon</h4><marked-element class="details-text" markdown="We declare schedule very soon. Stay tuned with us!"><div class="markdown-html"><p>We declare schedule very soon. Stay tuned with us!</p>
</div></marked-element></div></div></div></div>

    <!--<style include="shared-styles">
      :host {
        display: block;
      }

      .container[phone] {
        padding-right: 0;
        padding-left: 0;
      }

      schedule-day {
        margin-bottom: 64px;
      }
    </style>

    <app-route
      route="{{route}}"
      pattern="/:day"
      data="{{routeData}}"
      query-params="{{queryParams}}"
    ></app-route>

    <firebase-document
      id="userSessions"
      app-name="{$ firebase.name $}"
      path="{$ firebase.userSessionsPath $}/[[app.user.uid]]"
      data="{{persistedData}}">
    </firebase-document>

    <app-indexeddb-mirror
      session="{$ firebase.indexedDbSession $}"
      key="mySchedule"
      data="{{persistedData}}"
      persisted-data="{{app.user.sessions}}">
    </app-indexeddb-mirror>

    <div class="container" phone$="{{app.isPhoneSize}}">
      <schedule-subnav
        app="{{app}}"
        schedule="[[schedule]]"
        selected-day="[[app.selectedDay]]"
        filters="{{filters}}"
      ></schedule-subnav>

      <neon-animated-pages selected="[[app.selectedDay]]" attr-for-selected="name">
        <template is="dom-repeat" items="[[schedule]]" as="day" on-dom-change="updateCascadedNodes">
          <schedule-day
            name$="day[[_addToValue(index, 1)]]"
            app="{{app}}"
            day="[[day]]"
            filters="[[filters]]"
          ></schedule-day>
        </template>
        <template is="dom-if" if="{{app.user}}">
          <my-schedule
            name="myschedule"
            app="{{app}}"
            schedule="[[schedule]]"
          ></my-schedule>
        </template>
      </neon-animated-pages>
    </div>

    <session-details
      id="sessionDetails"
      app="{{app}}"
      session="[[_selectedSession]]"
      entry-animation="scale-up-animation"
      exit-animation="fade-out-animation"
      with-backdrop
    ></session-details>-->

  </template>

  <script>
    (function () {
      'use strict';

      Polymer({

        is: 'schedule-page',

        behaviors: [
          HOVERBOARD.PageBehavior,
          HOVERBOARD.CascadedBehavior,
          HOVERBOARD.UtilsBehavior
        ],

        properties: {
          route: {
            type: Object,
            notify: true
          },

          routeData: {
            type: Object
          },

          schedule: {
            type: Array
          },

          sessions: {
            type: Object
          },

          filters: {
            type: Array
          }
        },

        observers: [
          '_routePageChanged(routeData.day)',
          '_userChanged(app.user)',
          '_queryParamsChanged(queryParams, sessions)',
          '_filtersChanged(filters.splices)'
        ],

        listeners: {
          'iron-overlay-closed': '_resetSessionIdParam'
        },

        _routePageChanged: function (day) {
          if (this.selected) {
            if (!day) {
              var dayToSelect = null;
              var today = new Date().toISOString().substring(0, 10);
              if (this.schedule) {
                for (var i = 0, length = this.schedule.length; i < length; i++) {
                  if (today === this.schedule[i].date) {
                    dayToSelect = 'day' + (i + 1);
                  }
                }
              }
              this.set('routeData.day', (dayToSelect || 'day1'));
            } else if (day === 'myschedule' && !this.app.user) {
              this.set('routeData.day', 'day1');
            } else if (this.app.selectedDay !== day) {
              this.set('app.selectedDay', day);
            }
          }
        },

        _queryParamsChanged: function (params, sessions) {
          if (this.selected) {
            if (params.sessionId) {
              var session = this.sessions[params.sessionId];
              if (!session) {
                this._resetSessionIdParam();
                return;
              }

              window.requestAnimationFrame(function () {
                this._selectedSession = session;
                this.$.sessionDetails.open();
              }.bind(this));
            } else {
              window.requestAnimationFrame(function () {
                this.$.sessionDetails.cancel();
              }.bind(this));
            }
            if (params.filters) {
              this.set('filters', params.filters.split(','));
            } else {
              this.set('queryParams.filters', null);
            }
          }
        },

        _filtersChanged: function () {
          if (this.filters.length) {
            this.set('queryParams.filters', this.filters.join(','));
          }
          else {
            this.set('queryParams.filters', null);
          }
        },

        _resetSessionIdParam: function () {
          !this.$.sessionDetails.opened && this.set('queryParams.sessionId', null);
        },

        _userChanged: function (user) {
          if (!user && this.app.selectedDay === 'myschedule') {
            this.set('routeData.day', 'day1');
          }
        }

      });

    }());
  </script>

</dom-module>
